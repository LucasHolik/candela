This document outlines the development plan for the Candela project. The primary goal is to build the application in a structured, modular, and expandable way.

**Rules of Engagement:**
1.  We will follow the steps outlined in this plan.
2.  Changes will be small, atomic, and verifiable.
3.  **Only the user will execute `cargo` commands** (`check`, `build`, `run`). After I make a change, I will prompt you to run the necessary command.

### **Revised Project Plan: Candela**

**Our Development Philosophy:**

*   **Small, Atomic Changes:** We will make one logical change at a time.
*   **Verify at Every Step:** After each change, you will run `cargo check` to ensure the project compiles.
*   **Build and Test:** You will run `cargo build` and test the functionality of new features.

---

**Phase 1: Code Refactoring and Modularization (Our Immediate Focus)**

The goal is to clean up the existing code, establish a clear module structure, and remove unsafe patterns.

*   **1.1. Refactor `brightness.rs`:**
    *   Move the `set_software_brightness` function and its helper `monitor_enum_proc` from `main.rs` into `brightness.rs`. The `BrightnessController` will then call its own internal functions.
*   **1.2. Create `tray.rs` Module:**
    *   Move all tray icon and menu creation logic from `main.rs` into a new `tray.rs` module. `main.rs` will become much simpler.
*   **1.3. Introduce Safe State Management:**
    *   Create an `AppState` struct in `main.rs` to own the `BrightnessController` and other shared data. This will allow us to remove the `static mut` variable.

**Phase 2: Basic UI Window with `egui`**

*   **2.1.** Add `egui` dependencies.
*   **2.2.** Create a `gui.rs` module for an `egui` window.
*   **2.3.** Make the tray icon open this window on left-click.

**Phase 3: Connecting UI to Functionality**

*   **3.1.** Add a brightness slider to the UI.
*   **3.2.** Add a mode switch (Software/Hardware) to the UI.
*   **3.3.** Ensure the UI always reflects the true application state.

**Phase 4: Persistence and Polish**

*   **4.1.** Save and load user settings (mode, brightness).
*   **4.2.** Improve error handling and provide user feedback.
*   **4.3.** Add a final application icon and refine the tray menu.