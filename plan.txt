This document outlines the development plan for the Candela project. The primary goal is to build the application in a structured, modular, and expandable way using professional Windows development practices.

**Rules of Engagement:**
1.  We will follow the steps outlined in this plan.
2.  Changes will be small, atomic, and verifiable.
3.  **Only the user will execute `cargo` commands** (`check`, `build`, `run`). After I make a change, I will prompt you to run the necessary command.

### **Complete Project Plan: Candela (C++ System Tray Brightness Control)**

**Project Goal:** A system tray application written in C++ that allows users to control monitor brightness through hardware (DDC/CI) or software (gamma) controls.

**Development Philosophy:**

*   **Professional Win32 Implementation:** Using native Windows API for system tray functionality and UI components.
*   **Clean Architecture:** Proper separation of concerns with tray, GUI, and business logic modules.
*   **Small, Atomic Changes:** We will make one logical change at a time.
*   **Verify at Every Step:** After each change, you will run build commands to ensure the project compiles.
*   **Build and Test:** You will build and test the functionality of new features.

---

**Detailed Application Requirements:**

**Core Features:**
- Application runs automatically at Windows startup and runs in the system tray
- Left click on tray icon shows a compact window with dual vertical sliders (software and hardware brightness, 1-100)
- Each slider directly controls its respective brightness system independently (no toggle box)
- Shows current brightness percentages for both software and hardware controls
- Right click shows "Exit" and "Settings" options
- Settings window has "Start on Windows" checkbox and default mode toggle (software/hardware)

**Technical Implementation:**
- Written in C++ using native Win32 API
- Hardware brightness control via DDC/CI protocol using Windows Monitor Configuration API
- Software brightness control via gamma adjustment
- Settings persistence using Windows registry
- Startup automation via Windows registry

**Build Process:**
- Standard C++ compilation with Microsoft Visual Studio C++ compiler or MinGW/g++ 
- Single executable output (candela.exe)
- For distribution, create installer using NSIS (Nullsoft Scriptable Install System) or WiX Toolset
- Executable will be placed in program files and added to Windows startup via registry
- Static linking preferred to avoid DLL dependencies

**What We've Accomplished:**
- **Complete migration from Rust to C++:** Successfully converted the entire codebase from Rust to C++
- **System tray implementation:** Created a professional system tray application that runs silently
- **Dual slider UI:** Implemented two independent vertical sliders (software and hardware) side-by-side
- **Wider sliders for visibility:** Made sliders 63px wide for better visibility and usability
- **Compact window design:** Reduced the overall window size from 200px to 170px wide while maintaining functionality
- **Independent control:** Each slider now independently controls its respective brightness system
- **Brightness value displays:** Shows current brightness percentages below each slider
- **Right-click functionality:** Context menu with "Exit" and "Settings" options
- **Settings persistence:** Uses Windows registry to save user preferences
- **Windows startup integration:** Option to start automatically with Windows
- **DDC/CI hardware control:** Uses Windows Monitor Configuration API for hardware brightness
- **Gamma software control:** Software brightness via gamma ramp adjustment
- **Professional build system:** CMake-based build system with proper linking
- **Installer creation:** Provided NSIS installer script for Windows distribution
- **No mode toggle:** Removed the checkbox for switching between modes - each slider controls independently
- **Clean design:** Removed percentage markers (0% and 100%) for a cleaner look
- **Improved positioning:** Optimized slider positioning and alignment for better user experience
- **Hidden main window:** Application runs in system tray only, no main window appears
- **ESC/Enter support:** Added keyboard support to close the slider window
- **Multi-monitor support:** Hardware brightness control works across all connected monitors
- **Proper error handling:** Added error checking and user feedback mechanisms

**Phase 1: C++ Project Setup and Basic Structure**

*   **1.1.** Migrate from Rust to C++ project structure
*   **1.2.** Set up Win32 project with system tray icon
*   **1.3.** Create basic window and message loop

**Phase 2: Core Brightness Functionality**

*   **2.1.** Implement hardware brightness control (DDC/CI)
*   **2.2.** Implement software brightness control (gamma)
*   **2.3.** Create brightness value storage and retrieval

**Phase 3: User Interface**

*   **3.1.** Implement vertical slider dialog for left-click
*   **3.2.** Add hardware/software toggle control (later removed as per requirements)
*   **3.3.** Display current brightness values with active mode indicator
*   **3.4.** Implement dual sliders for independent hardware and software control
*   **3.5.** Optimize slider width and window size for better user experience

**Phase 4: Settings and Startup**

*   **4.1.** Add right-click context menu with Exit and Settings
*   **4.2.** Implement Settings dialog with startup options
*   **4.3.** Persist settings to Windows registry

**Phase 5: Polish and Deployment**

*   **5.1.** Add application icon
*   **5.2.** Final testing and debugging
*   **5.3.** Create Windows installer using NSIS or WiX Toolset
*   **5.4.** UI refinements and user experience improvements

**Technical Architecture:**
- Pure Win32 C++ implementation for tray functionality and UI
- Tray module handles system tray interactions
- GUI module manages slider and settings dialogs
- Brightness module manages both hardware and software brightness controls
- Settings module handles registry persistence
- Main module orchestrates application flow